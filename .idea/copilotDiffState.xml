<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/backend/src/main/java/org/thepaddlers/api/exception/ApiExceptionHandler.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/org/thepaddlers/api/exception/ApiExceptionHandler.java" />
              <option name="originalContent" value="package org.thepaddlers.api.exception;&#10;&#10;import org.springframework.http.HttpHeaders;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.http.converter.HttpMessageNotReadableException;&#10;import org.springframework.web.bind.MethodArgumentNotValidException;&#10;import org.springframework.web.bind.annotation.ControllerAdvice;&#10;import org.springframework.web.bind.annotation.ExceptionHandler;&#10;import org.springframework.web.server.ResponseStatusException;&#10;import org.thepaddlers.api.dto.ErrorResponse;&#10;&#10;import jakarta.servlet.http.HttpServletRequest;&#10;import org.springframework.security.access.AccessDeniedException;&#10;import org.springframework.security.core.AuthenticationException;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@ControllerAdvice&#10;public class ApiExceptionHandler {&#10;&#10;    @ExceptionHandler(HttpMessageNotReadableException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleBadJson(HttpMessageNotReadableException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.BAD_REQUEST, &quot;Malformed JSON request&quot;, req.getRequestURI(), &quot;API_INVALID_JSON&quot;);&#10;        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(MethodArgumentNotValidException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleValidation(MethodArgumentNotValidException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.UNPROCESSABLE_ENTITY, &quot;Validation failed&quot;, req.getRequestURI(), &quot;API_VALIDATION_ERROR&quot;);&#10;        return ResponseEntity.status(HttpStatus.UNPROCESSABLE_ENTITY).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(ResponseStatusException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleResponseStatus(ResponseStatusException ex, HttpServletRequest req) {&#10;        HttpStatus status = ex.getStatusCode();&#10;        ErrorResponse er = ErrorResponse.of(status, ex.getReason() != null ? ex.getReason() : ex.getMessage(), req.getRequestURI(), &quot;API_ERROR&quot;);&#10;        return ResponseEntity.status(status).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(AccessDeniedException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleAccessDenied(AccessDeniedException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.FORBIDDEN, &quot;Access denied&quot;, req.getRequestURI(), &quot;AUTH_FORBIDDEN&quot;);&#10;        return ResponseEntity.status(HttpStatus.FORBIDDEN).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(AuthenticationException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleAuthentication(AuthenticationException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.UNAUTHORIZED, &quot;Authentication failed&quot;, req.getRequestURI(), &quot;AUTH_INVALID_CREDENTIALS&quot;);&#10;        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(Exception.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleGeneric(Exception ex, HttpServletRequest req) {&#10;        ex.printStackTrace();&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.INTERNAL_SERVER_ERROR, &quot;Server error&quot;, req.getRequestURI(), &quot;SERVER_ERROR&quot;);&#10;        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(er);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.thepaddlers.api.exception;&#10;&#10;import org.springframework.http.HttpHeaders;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.http.converter.HttpMessageNotReadableException;&#10;import org.springframework.web.bind.MethodArgumentNotValidException;&#10;import org.springframework.web.bind.annotation.ControllerAdvice;&#10;import org.springframework.web.bind.annotation.ExceptionHandler;&#10;import org.springframework.web.server.ResponseStatusException;&#10;import org.thepaddlers.api.dto.ErrorResponse;&#10;&#10;import jakarta.servlet.http.HttpServletRequest;&#10;import org.springframework.security.access.AccessDeniedException;&#10;import org.springframework.security.core.AuthenticationException;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@ControllerAdvice&#10;public class ApiExceptionHandler {&#10;&#10;    @ExceptionHandler(HttpMessageNotReadableException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleBadJson(HttpMessageNotReadableException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.BAD_REQUEST, &quot;Malformed JSON request&quot;, req.getRequestURI(), &quot;API_INVALID_JSON&quot;);&#10;        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(MethodArgumentNotValidException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleValidation(MethodArgumentNotValidException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.UNPROCESSABLE_ENTITY, &quot;Validation failed&quot;, req.getRequestURI(), &quot;API_VALIDATION_ERROR&quot;);&#10;        return ResponseEntity.status(HttpStatus.UNPROCESSABLE_ENTITY).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(ResponseStatusException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleResponseStatus(ResponseStatusException ex, HttpServletRequest req) {&#10;        // ResponseStatusException#getStatusCode returns HttpStatusCode (Spring 6); resolve to HttpStatus safely&#10;        HttpStatus status = HttpStatus.resolve(ex.getStatusCode().value());&#10;        if (status == null) status = HttpStatus.INTERNAL_SERVER_ERROR;&#10;        ErrorResponse er = ErrorResponse.of(status, ex.getReason() != null ? ex.getReason() : ex.getMessage(), req.getRequestURI(), &quot;API_ERROR&quot;);&#10;        return ResponseEntity.status(status).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(AccessDeniedException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleAccessDenied(AccessDeniedException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.FORBIDDEN, &quot;Access denied&quot;, req.getRequestURI(), &quot;AUTH_FORBIDDEN&quot;);&#10;        return ResponseEntity.status(HttpStatus.FORBIDDEN).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(AuthenticationException.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleAuthentication(AuthenticationException ex, HttpServletRequest req) {&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.UNAUTHORIZED, &quot;Authentication failed&quot;, req.getRequestURI(), &quot;AUTH_INVALID_CREDENTIALS&quot;);&#10;        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(er);&#10;    }&#10;&#10;    @ExceptionHandler(Exception.class)&#10;    public ResponseEntity&lt;ErrorResponse&gt; handleGeneric(Exception ex, HttpServletRequest req) {&#10;        ex.printStackTrace();&#10;        ErrorResponse er = ErrorResponse.of(HttpStatus.INTERNAL_SERVER_ERROR, &quot;Server error&quot;, req.getRequestURI(), &quot;SERVER_ERROR&quot;);&#10;        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(er);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>